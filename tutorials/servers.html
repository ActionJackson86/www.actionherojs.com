<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="57x57" href="/static/images/icons/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/static/images/icons/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/static/images/icons/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/static/images/icons/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/static/images/icons/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/static/images/icons/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/static/images/icons/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/static/images/icons/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/static/images/icons/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/static/images/icons/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/images/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/static/images/icons/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/images/icons/favicon-16x16.png"/><link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css"/><link rel="stylesheet" type="text/css" href="/static/css/bebasNeue.css"/><link rel="stylesheet" type="text/css" href="/static/css/animations.css"/><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800|Roboto:100,300,400,500,700,900" rel="stylesheet"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Actionhero</title><script src="/static/js/googleAnalytics.js"></script><meta name="next-head-count" content="21"/><link rel="preload" href="/_next/static/chunks/main-34725f5a99cb2b2b6f00.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.a5d4ffe593e18b49243e.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.94d1ccb9dee116719961.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7d0481f4467570ea8ca6.js" as="script"/><link rel="preload" href="/_next/static/chunks/dd05285286c593a0e6da2f584467d9517f5816b2.be19a4f843a12596b98d.js" as="script"/><link rel="preload" href="/_next/static/chunks/27270cb085e17e8e99404fc0284c05b5fb1bb558.1923d1b6e48e3134e628.js" as="script"/><link rel="preload" href="/_next/static/chunks/e75431a1bdcb89b14e100a4a4bb0858c3732af66.b4fa2937edb4092f8c40.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/tutorials/%5Bname%5D-e4f5bf03c6c5960f3180.js" as="script"/></head><body><div id="__next"><div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300" class="container-fluid"><header style="background-color:#2F5266"><div class="container"><nav style="background-color:#2F5266;padding-top:5px;margin-bottom:0;border:0" class="navbar navbar-expand-lg navbar-light"><span class="navbar-brand"><a style="padding-top:0;margin-bottom:15px"><img src="/static/images/actionhero-logo-header-wordmark.svg" style="padding-top:14px;padding-bottom:20px"/></a></span><button aria-controls="basic-navbar-nav" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="basic-navbar-nav"><div class="mr-auto navbar-nav"><a style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;border-bottom:none;margin-right:20px" href="/why" data-rb-event-key="/why" class="nav-link">Why Actionhero?</a><a style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;border-bottom:none;margin-right:20px" href="/downloads" data-rb-event-key="/downloads" class="nav-link">Downloads</a><a style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;border-bottom:none;margin-right:20px" href="/tutorials" data-rb-event-key="/tutorials" class="nav-link">Tutorials</a><a style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;border-bottom:none;margin-right:20px" href="https://docs.actionherojs.com" data-rb-event-key="https://docs.actionherojs.com" class="nav-link">Docs</a><a style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;border-bottom:none;margin-right:20px" href="plugins" data-rb-event-key="plugins" class="nav-link">Plugins</a><a style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;border-bottom:none;margin-right:20px" href="community" data-rb-event-key="community" class="nav-link">Community</a><a style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300;border-bottom:none;margin-right:20px" href="https://actionherojs.threadless.com" data-rb-event-key="https://actionherojs.threadless.com" class="nav-link">Shop</a></div><div class="d-none d-xl-block navbar-nav"><div class="d-none d-lg-block"><a style="text-decoration:none" href="/get-started"><button style="font-family:Roboto, sans-serif;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;font-weight:300;margin-bottom:0;margin-left:10px;margin-right:10px;outline:none" type="button" class="btn btn-primary btn-block btn-lg">Get Started</button></a></div></div></div></nav></div></header></div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300" class="container-fluid"><div style="background-color:#FBF9E4;color:#2F5266;font-weight:200;padding:50px"><div class="container"><div class="row"><div style="text-align:center" class="col-md-3"><img src="/static/images/internet-of-things.svg"/></div><div style="text-align:center" class="col-md-6"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px"><br/>Servers</h1></div><div class="col-md-3"></div></div></div></div><div style="height:183px;background:url(&quot;/static/images/clouds-white.svg&quot;) no-repeat center #FBF9E4"></div><div style="padding-bottom:100px" class="container"><div class="row"><div id="_top"></div><div id="docPageContent" class="col-md-12"><div id="tutorialPageContent" class="row"><div class="col-md-9"><div><div id="Overview"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Overview</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>In Actionhero we have introduced a modular server system which allows you to create your own servers. Servers should be thought of as any type of listener to remote connections, streams, or event your server.</p><p>In Actionhero, the goal of each server is to ingest a specific type of connection and transform each client into a generic <code>connection</code> object which can be operated on by the rest of Actionhero. To help with this, all servers extend <code>Actionhero.Server</code> and fill in the required methods.</p><p>To get started, you can use the <code>actionhero generate server --name=myServer</code>. This will generate a template server which looks like the below.</p><p>Like initializers, the <code>start()</code> and <code>stop()</code> methods will be called when the server is to boot up in Actionhero&#x27;s lifecycle, but before any clients are permitted into the system. Here is where you should actually initialize your server (IE: <code>https.createServer.listen</code>, etc).</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span>import { Server } from </span><span style="color:#219161">&quot;actionhero&quot;</span><span style="color:#408080;font-style:italic">;</span><span>
</span>
<!-- -->module.exports = class MyServer extends Server {
<!-- -->  constructor() {
<span>    super()</span><span style="color:#408080;font-style:italic">;</span><span>
</span><span>    this.type = </span><span style="color:#219161">&quot;my-server&quot;</span><span style="color:#408080;font-style:italic">;</span><span>
</span>
<!-- -->    this.attributes = {
<span>      canChat: </span><span style="color:#954121">false</span><span>,
</span><span>      logConnections: </span><span style="color:#954121">true</span><span>,
</span><span>      logExits: </span><span style="color:#954121">true</span><span>,
</span><span>      sendWelcomeMessage: </span><span style="color:#954121">false</span><span>,
</span>      verbs: [],
<span>    }</span><span style="color:#408080;font-style:italic">;</span><span>
</span>    // this.config will be set to equal config.servers[this.type]
<!-- -->  }
<!-- -->
<!-- -->  initialize() {
<span>    this.on(</span><span style="color:#219161">&quot;connection&quot;</span><span>, (</span><span style="color:#000080;font-weight:normal">connection</span><span>) =&gt; {})</span><span style="color:#408080;font-style:italic">;</span><span>
</span>
<span>    this.on(</span><span style="color:#219161">&quot;actionComplete&quot;</span><span>, (</span><span style="color:#000080;font-weight:normal">data</span><span>) =&gt; {})</span><span style="color:#408080;font-style:italic">;</span><span>
</span>  }
<!-- -->
<!-- -->  start() {
<span>    // this.buildConnection (</span><span style="color:#000080;font-weight:normal">data</span><span>)
</span><span>    // this.processAction (</span><span style="color:#000080;font-weight:normal">connection</span><span>)
</span><span>    // this.processFile (</span><span style="color:#000080;font-weight:normal">connection</span><span>)
</span>  }
<!-- -->
<!-- -->  stop() {}
<!-- -->
<span>  sendMessage(</span><span style="color:#000080;font-weight:normal">connection</span><span>, message, messageId) {}
</span>
<span>  sendFile(</span><span style="color:#000080;font-weight:normal">connection</span><span>, error, fileStream, mime, length, lastModified) {}
</span>
<span>  goodbye(</span><span style="color:#000080;font-weight:normal">connection</span><span>) {}
</span><span>}</span><span style="color:#408080;font-style:italic">;</span></code></pre><div><div id="Designing Servers"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Designing Servers</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>Your job, as a server designer, is to coerce every client&#x27;s connection into a connection object. This is done with the <code>sever.buildConnection</code> helper. Here is an example from the <code>web</code> server:</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span>server.build</span><span class="hljs-constructor">Connection({
</span><span class="hljs-constructor">  </span><span class="hljs-constructor" style="color:#00f">rawConnection</span><span class="hljs-constructor">: {
</span><span class="hljs-constructor">    </span><span class="hljs-constructor" style="color:#00f">req</span><span class="hljs-constructor">: </span><span class="hljs-constructor" style="color:#00f">req</span><span class="hljs-constructor">,
</span><span class="hljs-constructor">    </span><span class="hljs-constructor" style="color:#00f">res</span><span class="hljs-constructor">: </span><span class="hljs-constructor" style="color:#00f">res</span><span class="hljs-constructor">,
</span><span class="hljs-constructor">    </span><span class="hljs-constructor" style="color:#00f">method</span><span class="hljs-constructor">: </span><span class="hljs-constructor" style="color:#00f">method</span><span class="hljs-constructor">,
</span><span class="hljs-constructor">    </span><span class="hljs-constructor" style="color:#00f">cookies</span><span class="hljs-constructor">: </span><span class="hljs-constructor" style="color:#00f">cookies</span><span class="hljs-constructor">,
</span><span class="hljs-constructor">    </span><span class="hljs-constructor" style="color:#00f">responseHeaders</span><span class="hljs-constructor">: </span><span class="hljs-constructor" style="color:#00f">responseHeaders</span><span class="hljs-constructor">,
</span><span class="hljs-constructor">    </span><span class="hljs-constructor" style="color:#00f">responseHttpCode</span><span class="hljs-constructor">: </span><span class="hljs-constructor" style="color:#00f">responseHttpCode</span><span class="hljs-constructor">,
</span><span class="hljs-constructor">    </span><span class="hljs-constructor" style="color:#00f">parsedURL</span><span class="hljs-constructor">: </span><span class="hljs-constructor" style="color:#00f">parsedURL</span><span class="hljs-constructor">,
</span>  },
<span class="hljs-constructor">  </span><span class="hljs-constructor" style="color:#00f">id</span><span class="hljs-constructor">: </span><span class="hljs-constructor" style="color:#00f">randomNumber</span><span class="hljs-constructor">()</span><span>,
</span>  remoteAddress: remoteIP,
<!-- -->  remotePort: req.connection.remotePort,
<span>}); </span><span style="color:#408080;font-style:italic">// will emit &quot;connection&quot;</span><span>
</span>
<span></span><span style="color:#408080;font-style:italic">// Note that connections will have a \`rawConnection\` property.  This is where you should store the actual object(s) returned by your server so that you can use them to communicate back with the client.  Again, an example from the \`web\` server:</span><span>
</span>
<span>server.sendMessage =</span><span class="hljs-function"> (</span><span class="hljs-function" style="color:#00f">connection</span><span class="hljs-function">, </span><span class="hljs-function" style="color:#00f">message</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>  clean</span><span class="hljs-constructor">Headers(</span><span class="hljs-constructor" style="color:#00f">connection</span><span class="hljs-constructor">)</span><span>;
</span>  const headers = connection.rawConnection.responseHeaders;
<span>  const responseHttpCode = parse</span><span class="hljs-constructor">Int(</span><span class="hljs-constructor" style="color:#00f">connection</span><span class="hljs-constructor">.</span><span class="hljs-constructor" style="color:#00f">rawConnection</span><span class="hljs-constructor">.</span><span class="hljs-constructor" style="color:#00f">responseHttpCode</span><span class="hljs-constructor">)</span><span>;
</span><span>  const stringResponse = </span><span class="hljs-constructor">String(</span><span class="hljs-constructor" style="color:#00f">message</span><span class="hljs-constructor">)</span><span>;
</span><span>  connection.rawConnection.res.write</span><span class="hljs-constructor">Head(</span><span class="hljs-constructor" style="color:#00f">responseHttpCode</span><span class="hljs-constructor">, </span><span class="hljs-constructor" style="color:#00f">headers</span><span class="hljs-constructor">)</span><span>;
</span><span>  connection.rawConnection.res.</span><span style="color:#954121">end</span><span>(stringResponse);
</span><span>  server.destroy</span><span class="hljs-constructor">Connection(</span><span class="hljs-constructor" style="color:#00f">connection</span><span class="hljs-constructor">)</span><span>;
</span>};
</code></pre><div><div id="Options and Attributes"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Options and Attributes</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>A server defines <code>attributes</code> which define it&#x27;s behavior. Variables like <code>canChat</code> are defined here. <code>options</code> are passed in, and come from <code>config.servers[serverName]</code>. These can be new variables (like https?) or they can also overwrite the set <code>attributes</code>.
The required attributes are provided in a generated server.</p><div><div id="Verbs"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Verbs</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span>allowedVerbs: [
</span><span>  </span><span style="color:#219161">&quot;quit&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;exit&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;paramAdd&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;paramDelete&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;paramView&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;paramsView&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;paramsDelete&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;roomChange&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;roomView&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;listenToRoom&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;silenceRoom&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;detailsView&quot;</span><span>,
</span><span>  </span><span style="color:#219161">&quot;say&quot;</span><span>,
</span>];
</code></pre><p>When an incoming message is detected, it is the server&#x27;s job to build <code>connection.params</code>. In the <code>web</code> server, this is accomplished by reading GET, POST, and form data. For <code>websocket</code> clients, that information is expected to be emitted as part of the action&#x27;s request. For other clients, like <code>socket</code>, Actionhero provides helpers for long-lasting clients to operate on themselves. These are called connection <code>verbs</code>.</p><p>Clients use verbs to add params to themselves, update the chat room they are in, and more. The list of verbs currently supported is listed above.</p><p>Your server should be smart enough to tell when a client is trying to run an action, request a file, or use a verb. One of the attributes of each server is <code>allowedVerbs</code>, which defines what verbs a client is allowed to preform. A simplified example of how the <code>socket</code> server does this:</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span>async parseRequest (</span><span style="color:#000080;font-weight:normal">connection</span><span>, line) {
</span><span>  let words = line.split(</span><span style="color:#000080;font-weight:normal">&#x27;</span><span> &#x27;)
</span>  let verb = words.shift()
<!-- -->
<span>  if (</span><span style="color:#000080;font-weight:normal">verb</span><span> === &#x27;file&#x27;) {
</span><span>    if (</span><span style="color:#000080;font-weight:normal">words.length</span><span> &gt; </span><span style="color:#40a070">0</span><span>) { connection.params.file = words[</span><span style="color:#40a070">0</span><span>] }
</span><span>    return this.processFile(</span><span style="color:#000080;font-weight:normal">connection</span><span>)
</span>  }
<!-- -->
<span>  if (</span><span style="color:#000080;font-weight:normal">this.attributes.verbs.indexOf</span><span>(</span><span style="color:#000080;font-weight:normal">verb</span><span>) &gt;= </span><span style="color:#40a070">0</span><span>) {
</span>    try {
<span>      let data = await connection.verbs(</span><span style="color:#000080;font-weight:normal">verb</span><span>, words)
</span><span>      return this.sendMessage(</span><span style="color:#000080;font-weight:normal">connection</span><span>, {status: &#x27;OK&#x27;, context: &#x27;response&#x27;, data: data})
</span><span>    } catch (</span><span style="color:#000080;font-weight:normal">error</span><span>) {
</span><span>      return this.sendMessage(</span><span style="color:#000080;font-weight:normal">connection</span><span>, {error: error, context: &#x27;response&#x27;})
</span>    }
<!-- -->  }
<!-- -->
<!-- -->  try {
<span>    let requestHash = JSON.parse(</span><span style="color:#000080;font-weight:normal">line</span><span>)
</span><span>    if (</span><span style="color:#000080;font-weight:normal">requestHash.params</span><span> !== undefined) {
</span>      connection.params = {}
<span>      for (</span><span style="color:#0086b3;font-weight:normal">let</span><span> v in requestHash.params) {
</span>        connection.params[v] = requestHash.params[v]
<!-- -->      }
<!-- -->    }
<span>    if (</span><span style="color:#000080;font-weight:normal">requestHash.action</span><span>) {
</span>      connection.params.action = requestHash.action
<!-- -->    }
<span>  } catch (</span><span style="color:#000080;font-weight:normal">e</span><span>) {
</span>    connection.params.action = verb
<!-- -->  }
<!-- -->  connection.error = null
<!-- -->  connection.response = {}
<span>  return this.processAction(</span><span style="color:#000080;font-weight:normal">connection</span><span>)
</span>}
</code></pre><div><div id="Chat"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Chat</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>The <code>attribute</code> &quot;canChat&quot; defines if clients of this server can chat. If clients can chat, they should be allowed to use verbs like &quot;roomChange&quot; and &quot;say&quot;. They will also be sent messages in their room (and rooms they are listening too) automatically.</p><div><div id="Sending Responses"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Sending Responses</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>All servers need to implement the <code>server.sendMessage = function(connection, message, messageId)</code> method so Actionhero knows how to talk to each client. This is likely to make use of <code>connection.rawConnection</code>. If you are writing a server for a persistent connection, it is likely you will need to respond with <code>messageId</code> so that the client knows which request your response is about (as they are not always going to get the responses in order).</p><div><div id="Sending Files"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Sending Files</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><p>Servers can optionally implement the <code>server.sendFile = function(connection, error, fileStream, mime, length)</code> method. This method is responsible for any connection-specific file transport (headers, chinking, encoding, etc). Note that fileStream is a <code>stream</code> which should be <code>pipe</code>&#x27;d to the client.</p><div><div id="Customizing Servers"><br/><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Customizing Servers</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div></div><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span>//</span><span style="color:#954121">Initializer</span><span>
</span><span> </span><span style="color:#954121">module</span><span style="color:#19469d">.exports</span><span> = {
</span><span>   </span><span style="color:#000080;font-weight:normal">startPriority</span><span>: </span><span style="color:#40a070">1000</span><span>,
</span>   start: function (api, next) {
<!-- -->     let webServer = api.servers.servers.web
<!-- -->     webServer.connectionCustomMethods = webServer.connectionCustomMethods || {}
<span>     </span><span style="color:#954121">webServer</span><span style="color:#19469d">.connectionCustomMethods</span><span style="color:#19469d">.requestHeaders</span><span> = </span><span style="color:#954121">function</span><span> (</span><span style="color:#954121">connection</span><span>) {
</span>       return connection.rawConnection.req.headers
<!-- -->     }
<!-- -->   }
<!-- --> }
<!-- -->
<span> //</span><span style="color:#954121">Action</span><span>
</span><span> </span><span style="color:#954121">module</span><span style="color:#19469d">.exports</span><span> = {
</span><span>   </span><span style="color:#000080;font-weight:normal">name</span><span>: </span><span style="color:#219161">&#x27;logHeaders&#x27;</span><span>,
</span><span>   description </span><span style="color:#219161">&#x27;Log Web Request Headers&#x27;</span><span>,
</span>   run: function (api, data, next) {
<span>     let headers = data.connection.</span><span style="color:#0086b3">requestHeaders</span><span>()
</span><span>     api.</span><span style="color:#0086b3">log</span><span>(</span><span style="color:#219161">&#x27;Headers:&#x27;</span><span>, </span><span style="color:#219161">&#x27;debug&#x27;</span><span>, headers)
</span><span>     </span><span style="color:#0086b3">next</span><span>()
</span>   }
<!-- --> }
</code></pre><p>The <code>connection</code> object passed to a server can be customized on a per server basis through the use of the <code>server.connectionCustomMethods</code> hash. The hash can be populated with functions whose signature must match <code>function (connection, ...)</code>. Once populated, these functions are curried to always pass <code>connection</code> as the first argument and applied to the <code>data.connection</code> object passed to Actions, and can be accessed via <code>data.connection.functionName(...)</code> within the action or middleware.</p><p>In this way, you can create custom methods on your connections.</p></div><div class="d-none d-md-block col-md-3"><div style="height:0"><div style="padding-top:90px;position:sticky;top:0"><ul style="list-style-type:none;padding-left:0;margin-left:0"></ul></div></div></div></div><br/><div><a style="text-decoration:none" href="/tutorials"><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-primary btn-block btn-lg">Back to Tutorials</button></a></div></div><div class="d-none d-md-block col-md-3"></div></div></div><div style="background-color:#6E8898;color:#2F5266;font-weight:300;padding-top:100px;padding-bottom:100px"><div class="container"><div class="row"><div class="col-md-2"></div><div style="text-align:center;color:#FBF9E4;padding-bottom:100px" class="col-md-8"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Solutions</h1><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="color:#FBF9E4">Actionhero was built from the ground up to include all the features you expect from a modern API framework.</span></h2></div><div class="col-md-2"></div></div><div class="row"><div class="col-md-4"><div style="width:100%;padding-top:40px;padding-bottom:40px;padding-left:40px;padding-right:50px;background-color:#FBF9E4;box-shadow:0px 2px 4px #003C51"><div style="text-align:center;padding-bottom:10px"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Open Source</h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>The Actionhero server is open source, under the Apache-2 license</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>Actionhero runs on Linux, OS X, and Windows</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>You always have access to the Actionhero team via<!-- --> <a href="/community">Slack and Github</a></p><br/><br/><div><a style="text-decoration:none" href="/downloads"><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-primary btn-block btn-lg">Download</button></a></div></div></div><div class="d-lg-none col-md-4"><div style="width:100%;padding:20px;background-color:#2F5266;color:#FFFFFF;box-shadow:0px 2px 4px #003C51"><div style="text-align:center"><img src="/static/images/dog.svg"/><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px"><span style="color:#FBF9E4">Premium Training &amp; Review</span></h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We provide support for corporate &amp; nonprofit customers starting at a flat rate of $150/hr. Our services include:</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><ul><li><strong>Remote training for your team</strong></li><li><strong>Code Reviews</strong></li><li><strong>Best Practices Audits</strong></li><li><strong>Custom plugin &amp; Feature Development</strong></li></ul><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We have packages appropriate for all company sizes. Contact us to learn more.</p><br/><div><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-primary btn-block btn-lg">Contact Us</button></div></div></div><div class="d-none d-lg-block col-md-4"><div style="width:125%;padding:40px;background-color:#2F5266;color:#FFFFFF;position:relative;top:-60px;box-shadow:0px 2px 4px #003C51;margin-left:-13%;margin-right:-5%;z-index:10"><div style="text-align:center;padding-bottom:10px"><img src="/static/images/dog.svg"/><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Premium Training &amp; Review</h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We provide support for corporate &amp; nonprofit customers starting at a flat rate of $150/hr. Our services include:</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><ul><li><strong>Remote training for your team</strong></li><li><strong>Code Reviews</strong></li><li><strong>Best Practices Workshops</strong></li><li><strong>Custom plugin &amp; Feature Development</strong></li></ul><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We have packages appropriate for all company sizes. Contact us to learn more.</p><br/><div><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-primary btn-block btn-lg">Contact Us</button></div></div></div><div class="col-md-4"><div style="width:100%;padding-top:40px;padding-bottom:40px;padding-right:40px;padding-left:50px;background-color:#FBF9E4;box-shadow:0px 2px 4px #003C51"><div style="text-align:center;padding-bottom:10px"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Enterprise</h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>For larger customers in need of a support contract, we offer an enterprise plan including everything in the Premium plan plus:</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><ul><li><strong>24/7 access to core members of the Actionhero Team</strong></li><li><strong>Emergency response packages</strong></li><li><strong>Deployment support</strong></li><li><strong>...and custom development against Actionhero’s core as needed.</strong></li></ul><br/><div><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-primary btn-block btn-lg">Contact Us</button></div></div></div></div></div></div></div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300" class="container-fluid"><footer id="footer-container" style="background-color:#2F5266;color:#FBF9E4;font-family:Roboto, sans-serif;font-weight:200"><div class="container"><div style="padding-bottom:50px;padding-top:50px;padding-left:100px" class="row"><div class="col-md-12"><img src="/static/images/actionhero-logo-header-wordmark.svg"/></div></div><div style="padding-bottom:100px" class="row"><div class="col-md-4"><div style="padding-left:100px"><p><a style="color:#FBF9E4" href="/terms">Terms</a></p><p>Contact us at<!-- --> <a style="color:#FBF9E4;font-weight:500" href="mailto:hello@actionherojs.com">hello@actionherojs.com</a></p><p>You can contribute to this website<!-- --> <a style="color:#FBF9E4;font-weight:500" href="https://github.com/actionhero/www.actionherojs.com" target="_blank">here</a>.</p><p><a href="https://medium.com/tag/actionherojs/latest" target="_new" style="color:#FBF9E4">Blogs</a></p><p style="color:#FFFFFF;font-weight:bold">© 2020<!-- --> <!-- -->Actionhero</p></div></div><div class="col-md-4"><div style="padding-left:100px"><p><a style="color:#FBF9E4" href="/why">Why Actionhero</a></p><p><a style="color:#FBF9E4" href="/get-started">Get Started</a></p><p><a style="color:#FBF9E4" href="/key-concepts">Key Concepts</a></p><p><a href="https://docs.actionherojs.com" style="color:#FBF9E4">Documenation</a></p><p><a style="color:#FBF9E4" href="/solutions">Solutions</a></p><p><a style="color:#FBF9E4" href="/community">Community</a></p><p><a style="color:#FBF9E4" href="/downloads">Downloads</a></p></div></div><div class="col-md-4"><div style="padding-left:100px"><p><a href="https://www.npmjs.com/package/actionhero" target="_new" style="color:#FBF9E4">NPM</a></p><p><a href="https://twitter.com/actionherojs" target="_new" style="color:#FBF9E4">Twitter</a></p><p><a href="https://slack.actionherojs.com/" target="_new" style="color:#FBF9E4">Slack</a></p><p><a href="https://github.com/Actionhero/Actionhero" target="_new" style="color:#FBF9E4">Github</a></p><p><a href="https://actionherojs.threadless.com" target="_new" style="color:#FBF9E4">Shop</a></p></div></div></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"markdown":"## Overview\n\nIn Actionhero we have introduced a modular server system which allows you to create your own servers. Servers should be thought of as any type of listener to remote connections, streams, or event your server.\n\nIn Actionhero, the goal of each server is to ingest a specific type of connection and transform each client into a generic `connection` object which can be operated on by the rest of Actionhero. To help with this, all servers extend `Actionhero.Server` and fill in the required methods.\n\nTo get started, you can use the `actionhero generate server --name=myServer`. This will generate a template server which looks like the below.\n\nLike initializers, the `start()` and `stop()` methods will be called when the server is to boot up in Actionhero's lifecycle, but before any clients are permitted into the system. Here is where you should actually initialize your server (IE: `https.createServer.listen`, etc).\n\n```ts\nimport { Server } from \"actionhero\";\n\nmodule.exports = class MyServer extends Server {\n  constructor() {\n    super();\n    this.type = \"my-server\";\n\n    this.attributes = {\n      canChat: false,\n      logConnections: true,\n      logExits: true,\n      sendWelcomeMessage: false,\n      verbs: [],\n    };\n    // this.config will be set to equal config.servers[this.type]\n  }\n\n  initialize() {\n    this.on(\"connection\", (connection) =\u003e {});\n\n    this.on(\"actionComplete\", (data) =\u003e {});\n  }\n\n  start() {\n    // this.buildConnection (data)\n    // this.processAction (connection)\n    // this.processFile (connection)\n  }\n\n  stop() {}\n\n  sendMessage(connection, message, messageId) {}\n\n  sendFile(connection, error, fileStream, mime, length, lastModified) {}\n\n  goodbye(connection) {}\n};\n```\n\n## Designing Servers\n\nYour job, as a server designer, is to coerce every client's connection into a connection object. This is done with the `sever.buildConnection` helper. Here is an example from the `web` server:\n\n```ts\nserver.buildConnection({\n  rawConnection: {\n    req: req,\n    res: res,\n    method: method,\n    cookies: cookies,\n    responseHeaders: responseHeaders,\n    responseHttpCode: responseHttpCode,\n    parsedURL: parsedURL,\n  },\n  id: randomNumber(),\n  remoteAddress: remoteIP,\n  remotePort: req.connection.remotePort,\n}); // will emit \"connection\"\n\n// Note that connections will have a \\`rawConnection\\` property.  This is where you should store the actual object(s) returned by your server so that you can use them to communicate back with the client.  Again, an example from the \\`web\\` server:\n\nserver.sendMessage = (connection, message) =\u003e {\n  cleanHeaders(connection);\n  const headers = connection.rawConnection.responseHeaders;\n  const responseHttpCode = parseInt(connection.rawConnection.responseHttpCode);\n  const stringResponse = String(message);\n  connection.rawConnection.res.writeHead(responseHttpCode, headers);\n  connection.rawConnection.res.end(stringResponse);\n  server.destroyConnection(connection);\n};\n```\n\n## Options and Attributes\n\nA server defines `attributes` which define it's behavior. Variables like `canChat` are defined here. `options` are passed in, and come from `config.servers[serverName]`. These can be new variables (like https?) or they can also overwrite the set `attributes`.\nThe required attributes are provided in a generated server.\n\n## Verbs\n\n```ts\nallowedVerbs: [\n  \"quit\",\n  \"exit\",\n  \"paramAdd\",\n  \"paramDelete\",\n  \"paramView\",\n  \"paramsView\",\n  \"paramsDelete\",\n  \"roomChange\",\n  \"roomView\",\n  \"listenToRoom\",\n  \"silenceRoom\",\n  \"detailsView\",\n  \"say\",\n];\n```\n\nWhen an incoming message is detected, it is the server's job to build `connection.params`. In the `web` server, this is accomplished by reading GET, POST, and form data. For `websocket` clients, that information is expected to be emitted as part of the action's request. For other clients, like `socket`, Actionhero provides helpers for long-lasting clients to operate on themselves. These are called connection `verbs`.\n\nClients use verbs to add params to themselves, update the chat room they are in, and more. The list of verbs currently supported is listed above.\n\nYour server should be smart enough to tell when a client is trying to run an action, request a file, or use a verb. One of the attributes of each server is `allowedVerbs`, which defines what verbs a client is allowed to preform. A simplified example of how the `socket` server does this:\n\n```ts\nasync parseRequest (connection, line) {\n  let words = line.split(' ')\n  let verb = words.shift()\n\n  if (verb === 'file') {\n    if (words.length \u003e 0) { connection.params.file = words[0] }\n    return this.processFile(connection)\n  }\n\n  if (this.attributes.verbs.indexOf(verb) \u003e= 0) {\n    try {\n      let data = await connection.verbs(verb, words)\n      return this.sendMessage(connection, {status: 'OK', context: 'response', data: data})\n    } catch (error) {\n      return this.sendMessage(connection, {error: error, context: 'response'})\n    }\n  }\n\n  try {\n    let requestHash = JSON.parse(line)\n    if (requestHash.params !== undefined) {\n      connection.params = {}\n      for (let v in requestHash.params) {\n        connection.params[v] = requestHash.params[v]\n      }\n    }\n    if (requestHash.action) {\n      connection.params.action = requestHash.action\n    }\n  } catch (e) {\n    connection.params.action = verb\n  }\n  connection.error = null\n  connection.response = {}\n  return this.processAction(connection)\n}\n```\n\n## Chat\n\nThe `attribute` \"canChat\" defines if clients of this server can chat. If clients can chat, they should be allowed to use verbs like \"roomChange\" and \"say\". They will also be sent messages in their room (and rooms they are listening too) automatically.\n\n## Sending Responses\n\nAll servers need to implement the `server.sendMessage = function(connection, message, messageId)` method so Actionhero knows how to talk to each client. This is likely to make use of `connection.rawConnection`. If you are writing a server for a persistent connection, it is likely you will need to respond with `messageId` so that the client knows which request your response is about (as they are not always going to get the responses in order).\n\n## Sending Files\n\nServers can optionally implement the `server.sendFile = function(connection, error, fileStream, mime, length)` method. This method is responsible for any connection-specific file transport (headers, chinking, encoding, etc). Note that fileStream is a `stream` which should be `pipe`'d to the client.\n\n## Customizing Servers\n\n```ts\n//Initializer\n module.exports = {\n   startPriority: 1000,\n   start: function (api, next) {\n     let webServer = api.servers.servers.web\n     webServer.connectionCustomMethods = webServer.connectionCustomMethods || {}\n     webServer.connectionCustomMethods.requestHeaders = function (connection) {\n       return connection.rawConnection.req.headers\n     }\n   }\n }\n\n //Action\n module.exports = {\n   name: 'logHeaders',\n   description 'Log Web Request Headers',\n   run: function (api, data, next) {\n     let headers = data.connection.requestHeaders()\n     api.log('Headers:', 'debug', headers)\n     next()\n   }\n }\n```\n\nThe `connection` object passed to a server can be customized on a per server basis through the use of the `server.connectionCustomMethods` hash. The hash can be populated with functions whose signature must match `function (connection, ...)`. Once populated, these functions are curried to always pass `connection` as the first argument and applied to the `data.connection` object passed to Actions, and can be accessed via `data.connection.functionName(...)` within the action or middleware.\n\nIn this way, you can create custom methods on your connections.\n","name":"servers"}},"page":"/tutorials/[name]","query":{"name":"servers"},"buildId":"Bi8zX94g88TeljxT54m8H","nextExport":true,"isFallback":false,"gip":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-a2ec81a3b359d83082c2.js"></script><script src="/_next/static/chunks/main-34725f5a99cb2b2b6f00.js" async=""></script><script src="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" async=""></script><script src="/_next/static/chunks/framework.a5d4ffe593e18b49243e.js" async=""></script><script src="/_next/static/chunks/commons.94d1ccb9dee116719961.js" async=""></script><script src="/_next/static/chunks/pages/_app-7d0481f4467570ea8ca6.js" async=""></script><script src="/_next/static/chunks/dd05285286c593a0e6da2f584467d9517f5816b2.be19a4f843a12596b98d.js" async=""></script><script src="/_next/static/chunks/27270cb085e17e8e99404fc0284c05b5fb1bb558.1923d1b6e48e3134e628.js" async=""></script><script src="/_next/static/chunks/e75431a1bdcb89b14e100a4a4bb0858c3732af66.b4fa2937edb4092f8c40.js" async=""></script><script src="/_next/static/chunks/pages/tutorials/%5Bname%5D-e4f5bf03c6c5960f3180.js" async=""></script><script src="/_next/static/Bi8zX94g88TeljxT54m8H/_buildManifest.js" async=""></script><script src="/_next/static/Bi8zX94g88TeljxT54m8H/_ssgManifest.js" async=""></script></body></html>